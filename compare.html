<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ECO SMART ANALYZER – Compare Projects</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .chart-container {
      position: relative;
      height: 400px;
      width: 100%;
      max-width: 800px;
      margin: 20px auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    tr:nth-child(even) { background-color: #f9f9f9; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

  <header class="bg-white shadow-md">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-blue-700">ECO SMART ANALYZER</h1>
      <nav class="space-x-4">
        <a href="./index.html" class="text-gray-600 hover:text-blue-700">Home</a>
        <a href="./compare.html" class="text-blue-700 font-semibold">Compare Projects</a>
        <a href="./footprint.html" class="text-gray-600 hover:text-blue-700">Carbon Footprint</a>
        <a href="./quality.html" class="text-gray-600 hover:text-blue-700">Air & Water Quality</a>
      </nav>
    </div>
  </header>

  <main class="container mx-auto p-4">
    <section id="compare" class="bg-white p-6 rounded-lg shadow-lg">
      <h2 class="text-3xl font-semibold mb-6 text-center">Compare Infrastructure Projects</h2>
      
      <!-- Upload CSV -->
      <div class="mb-6 text-center">
        <label class="font-semibold">Upload compareDATA.csv:</label>
        <input type="file" id="csvFile" accept=".csv" class="mt-2 p-2 border border-gray-300 rounded-md">
      </div>

      <!-- Project Selectors -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
          <label for="project1Select" class="block text-sm font-medium text-gray-700 mb-2">Select Project 1</label>
          <select id="project1Select" class="w-full p-2 border border-gray-300 rounded-md">
            <option value="">Select a project...</option>
          </select>
        </div>
        <div>
          <label for="project2Select" class="block text-sm font-medium text-gray-700 mb-2">Select Project 2</label>
          <select id="project2Select" class="w-full p-2 border border-gray-300 rounded-md">
            <option value="">Select a project...</option>
          </select>
        </div>
      </div>

      <!-- Form -->
      <form id="compareForm">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <fieldset class="border p-4 rounded-md">
            <legend class="text-lg font-semibold px-2">Project 1 Details</legend>
            <div class="space-y-3">
              <label class="block">Project Name:
                <input type="text" id="p1-name" readonly class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
              <label class="block">CO₂ Emissions (kg/yr):
                <input type="number" id="p1-co2" readonly class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
              <label class="block">Water Usage (m³/yr):
                <input type="number" id="p1-water" readonly class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
              <label class="block">Land Footprint (ha):
                <input type="number" id="p1-land" step="0.1" readonly class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
              <label class="block">Initial Cost (₹ crore):
                <input type="number" id="p1-cost" step="0.1" readonly class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
              <label class="block">Annual Energy (MWh/yr):
                <input type="number" id="p1-energy" readonly class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
              <label class="block">Biodiversity Impact (1–10):
                <input type="number" id="p1-biodiversity" readonly min="1" max="10" class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
              <label class="block">Jobs Created:
                <input type="number" id="p1-jobs" readonly class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
            </div>
          </fieldset>

          <!-- Project 2 -->
          <fieldset class="border p-4 rounded-md">
            <legend class="text-lg font-semibold px-2">Project 2 Details</legend>
            <div class="space-y-3">
              <label class="block">Project Name:
                <input type="text" id="p2-name" readonly class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
              <label class="block">CO₂ Emissions (kg/yr):
                <input type="number" id="p2-co2" readonly class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
              <label class="block">Water Usage (m³/yr):
                <input type="number" id="p2-water" readonly class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
              <label class="block">Land Footprint (ha):
                <input type="number" id="p2-land" readonly class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
              <label class="block">Initial Cost (₹ crore):
                <input type="number" id="p2-cost" readonly class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
              <label class="block">Annual Energy (MWh/yr):
                <input type="number" id="p2-energy" readonly class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
              <label class="block">Biodiversity Impact (1–10):
                <input type="number" id="p2-biodiversity" readonly min="1" max="10" class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
              <label class="block">Jobs Created:
                <input type="number" id="p2-jobs" readonly class="mt-1 block w-full p-2 bg-gray-100 border border-gray-300 rounded-md">
              </label>
            </div>
          </fieldset>
        </div>

        <!-- Metrics -->
        <fieldset id="metricsFilter" class="border p-4 rounded-md mt-6">
          <legend class="text-lg font-semibold px-2">Select Metrics to Compare</legend>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-2">
            <label><input type="checkbox" value="co2" checked> CO₂ Emissions</label>
            <label><input type="checkbox" value="water" checked> Water Usage</label>
            <label><input type="checkbox" value="land" checked> Land Footprint</label>
            <label><input type="checkbox" value="cost" checked> Initial Cost</label>
            <label><input type="checkbox" value="energy" checked> Annual Energy</label>
            <label><input type="checkbox" value="biodiversity" checked> Biodiversity</label>
            <label><input type="checkbox" value="jobs" checked> Jobs Created</label>
          </div>
        </fieldset>

        <!-- Compare -->
        <div class="flex items-center justify-between mt-6">
          <label>Chart Type:
            <select id="chartType" class="mt-1 p-2 border border-gray-300 rounded-md">
              <option value="bar">Bar</option>
              <option value="line">Line</option>
              <option value="radar">Radar</option>
            </select>
          </label>
          <button type="submit" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-md hover:bg-blue-700">Compare</button>
        </div>
      </form>

      <!-- Results -->
      <div id="results" class="mt-8 hidden">
        <div class="chart-container"><canvas id="compareChart"></canvas></div>
        <table id="compareTable" class="min-w-full bg-white shadow rounded-lg"></table>
        <section id="summary" class="mt-6 bg-gray-50 p-4 rounded-lg"></section>
      </div>
    </section>
  </main>

  <div id="notification" class="hidden fixed top-5 right-5 bg-red-500 text-white p-4 rounded-lg shadow-md">
    <span id="notificationMessage"></span>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    let projectsData = [];
    const p1Sel = document.getElementById('project1Select');
    const p2Sel = document.getElementById('project2Select');
    let chart = null;

    const metrics = [
      { key:'co2', label:'CO₂ Emissions (kg/yr)', better:'lower' },
      { key:'water', label:'Water Usage (m³/yr)', better:'lower' },
      { key:'land', label:'Land Footprint (ha)', better:'lower' },
      { key:'cost', label:'Initial Cost (₹ crore)', better:'lower' },
      { key:'energy', label:'Annual Energy (MWh/yr)', better:'higher' },
      { key:'biodiversity', label:'Biodiversity Impact (1–10)', better:'lower' },
      { key:'jobs', label:'Jobs Created', better:'higher' }
    ];

    // Load CSV locally via file input
    document.getElementById('csvFile').addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      Papa.parse(file, {
        header: true,
        skipEmptyLines: true,
        complete: res => {
          projectsData = res.data;
          p1Sel.innerHTML = '<option value="">Select a project...</option>';
          p2Sel.innerHTML = '<option value="">Select a project...</option>';
          projectsData.forEach(p => {
            p1Sel.add(new Option(p.name, p.name));
            p2Sel.add(new Option(p.name, p.name));
          });
          showNotification('✅ CSV data loaded successfully!');
        }
      });
    });

    function fill(num, name) {
      const p = projectsData.find(x => x.name === name);
      metrics.forEach(m => {
        document.getElementById(`p${num}-${m.key}`).value = p ? p[m.key] : '';
      });
      document.getElementById(`p${num}-name`).value = p ? p.name : '';
    }

    p1Sel.addEventListener('change', e => fill(1, e.target.value));
    p2Sel.addEventListener('change', e => fill(2, e.target.value));

    function showNotification(msg) {
      const n = document.getElementById('notification');
      const m = document.getElementById('notificationMessage');
      m.textContent = msg;
      n.classList.remove('hidden');
      setTimeout(() => n.classList.add('hidden'), 3000);
    }

    document.getElementById('compareForm').addEventListener('submit', e => {
      e.preventDefault();
      const n1 = document.getElementById('p1-name').value;
      const n2 = document.getElementById('p2-name').value;
      if (!n1 || !n2) return showNotification('Please select both projects.');
      if (n1 === n2) return showNotification('Projects must be different.');

      const keys = Array.from(document.querySelectorAll('#metricsFilter input:checked')).map(c => c.value);
      const labels = [], d1 = [], d2 = [];
      metrics.forEach(m => {
        if (!keys.includes(m.key)) return;
        labels.push(m.label);
        d1.push(parseFloat(document.getElementById(`p1-${m.key}`).value) || 0);
        d2.push(parseFloat(document.getElementById(`p2-${m.key}`).value) || 0);
      });

      document.getElementById('results').classList.remove('hidden');
      const ctx = document.getElementById('compareChart').getContext('2d');
      if (chart) chart.destroy();
      const type = document.getElementById('chartType').value;
      chart = new Chart(ctx, {
        type,
        data: {
          labels,
          datasets: [
            { label: n1, data: d1, backgroundColor: 'rgba(54,162,235,0.6)', borderColor: 'rgba(54,162,235,1)' },
            { label: n2, data: d2, backgroundColor: 'rgba(255,99,132,0.6)', borderColor: 'rgba(255,99,132,1)' }
          ]
        },
        options: { responsive: true, maintainAspectRatio: false }
      });

      // Table + summary
      const tbl = document.getElementById('compareTable');
      let html = `<thead><tr><th>Metric</th><th>${n1}</th><th>${n2}</th><th>Better</th></tr></thead><tbody>`;
      let s1 = 0, s2 = 0;
      metrics.forEach(m => {
        if (!keys.includes(m.key)) return;
        const v1 = parseFloat(document.getElementById(`p1-${m.key}`).value)||0;
        const v2 = parseFloat(document.getElementById(`p2-${m.key}`).value)||0;
        let win='Tie', c='text-gray-500';
        if (m.better==='lower'){ if(v1<v2){win=n1;s1++;c='text-green-600';} else if(v2<v1){win=n2;s2++;c='text-green-600';} }
        else { if(v1>v2){win=n1;s1++;c='text-green-600';} else if(v2>v1){win=n2;s2++;c='text-green-600';} }
        html += `<tr><td>${m.label}</td><td>${v1}</td><td>${v2}</td><td class="${c}">${win}</td></tr>`;
      });
      tbl.innerHTML = html + '</tbody>';
      let summary = "It's a tie!", color = "text-blue-600";
      if (s1>s2){summary=`${n1} is better.`;color='text-green-700';}
      else if (s2>s1){summary=`${n2} is better.`;color='text-green-700';}
      document.getElementById('summary').innerHTML = `
        <h3 class="text-2xl font-semibold mb-3 text-center">Overall Summary</h3>
        <p class="text-center text-lg"><strong>${n1}</strong> wins ${s1} metrics.</p>
        <p class="text-center text-lg"><strong>${n2}</strong> wins ${s2} metrics.</p>
        <p class="text-center text-xl font-bold mt-4 ${color}">${summary}</p>`;
    });
  });
  </script>
</body>
</html>
