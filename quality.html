<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ECO SMART ANALYZER â€“ Air & Water Quality</title>
<link rel="stylesheet" href="style1.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
<style>
  body { font-family: 'Open Sans', sans-serif; margin:0; padding:0; }
  header { position: sticky; top:0; background:#fff; padding:1rem 2rem; box-shadow:0 4px 12px rgba(0,0,0,0.2); z-index:100; }
  header h1 { margin:0; font-family:'Montserrat',sans-serif; color:#0277bd; }
  nav a { margin-right:1rem; color:#004c8c; text-decoration:none; font-weight:600; }
  nav a:hover { color:#0277bd; }
  section { max-width:1000px; margin:2rem auto; padding:1rem; }
  .chart-container { margin:2rem 0; background:#f9f9f9; padding:1rem; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
  #regionComparison { width:100%; border-collapse:collapse; margin-top:1rem; }
  #regionComparison th, #regionComparison td { padding:0.5rem 1rem; border:1px solid #ddd; text-align:center; }
  #regionComparison th { background:#0277bd; color:#fff; }
</style>
</head>
<body>

<header>
  <h1>ECO SMART ANALYZER</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="compare.html">Compare Projects</a>
    <a href="footprint.html">Carbon Footprint</a>
    <a href="quality.html">Air & Water Quality</a>
  </nav>
</header>

<section>
  <h2>Air & Water Quality Analytics</h2>
  <label>Select CSV file (Air or Water Data): 
    <input type="file" id="csvFile" accept=".csv">
  </label>
  <button id="loadData">Load Data</button>

  <div id="chartsContainer"></div>
  <table id="regionComparison"></table>
</section>

<script>
let charts = [];

document.getElementById('loadData').addEventListener('click', function(){
  const fileInput = document.getElementById('csvFile');
  if(!fileInput.files[0]) return alert('Please select a CSV file!');
  const reader = new FileReader();
  reader.onload = function(e){
    const text = e.target.result;
    const data = parseCSV(text);
    renderCharts(data);
  };
  reader.readAsText(fileInput.files[0]);
});

function parseCSV(text){
  const lines = text.trim().split('\n');
  const headers = lines[0].split(',').map(h=>h.trim());
  return lines.slice(1).map(line=>{
    const cols = line.split(',').map(c=>c.trim());
    const obj = {};
    headers.forEach((h,i)=> obj[h]=cols[i]);
    return obj;
  });
}

function renderCharts(data){
  // Clear previous charts
  charts.forEach(c=>c.destroy());
  charts = [];
  document.getElementById('chartsContainer').innerHTML = '';
  const numericParams = Object.keys(data[0]).filter(k=>k!=='Date' && k!=='Region');
  const regions = [...new Set(data.map(d=>d.Region))];
  
  const comparisonTable = [];
  
  numericParams.forEach(param=>{
    const canvas = document.createElement('canvas');
    canvas.classList.add('chart-canvas');
    const div = document.createElement('div');
    div.classList.add('chart-container');
    div.appendChild(canvas);
    document.getElementById('chartsContainer').appendChild(div);
    
    const datasets = regions.map(region=>{
      const points = data.filter(d=>d.Region===region)
                         .map(d=>({x:new Date(d.Date), y:parseFloat(d[param])}));
      return { label: region, data: points, fill:false, tension:0.2, borderColor:`hsl(${Math.random()*360},70%,50%)`};
    });

    const chart = new Chart(canvas.getContext('2d'),{
      type:'line',
      data:{ datasets },
      options:{
        responsive:true,
        plugins:{ title:{ display:true, text:param, font:{ size:18 } } },
        scales:{ x:{ type:'time', time:{ unit:'day' } }, y:{ beginAtZero:false } }
      }
    });
    charts.push(chart);
    
    // Compute best and worst regions
    const comp = regions.map(region=>{
      const vals = data.filter(d=>d.Region===region).map(d=>parseFloat(d[param]));
      return { region, min:Math.min(...vals), max:Math.max(...vals) };
    });
    const worst = comp.reduce((a,b)=>b.max>a.max?b:a);
    const best = comp.reduce((a,b)=>b.min<a.min?b:a);
    comparisonTable.push({ param, best:best.region+' ('+best.min+')', worst:worst.region+' ('+worst.max+')' });
  });
  
  // Render comparison table
  const tbl = document.getElementById('regionComparison');
  tbl.innerHTML = '<tr><th>Parameter</th><th>Best Region</th><th>Worst Region</th></tr>';
  comparisonTable.forEach(r=>{
    tbl.innerHTML += `<tr><td>${r.param}</td><td>${r.best}</td><td>${r.worst}</td></tr>`;
  });
}
</script>

</body>
</html>
